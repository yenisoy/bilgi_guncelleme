<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel YÃ¼kle - Bilgi DoÄŸrulama</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/admin.css?v=2">
</head>

<body>

    <body>
        <nav class="navbar navbar-expand-lg">
            <div class="container-fluid">
                <a href="dashboard.html" class="navbar-brand">
                    <span>ğŸ“ Bilgi DoÄŸrulama</span>
                </a>
                <div class="navbar-nav">
                    <a href="dashboard.html" class="nav-link">KiÅŸiler</a>
                    <a href="import.html" class="nav-link active">Excel YÃ¼kle</a>
                    <a href="changes.html" class="nav-link">
                        DeÄŸiÅŸiklikler
                        <span id="pending-badge" class="nav-badge" style="display: none;">0</span>
                    </a>
                    <a href="definitions.html" class="nav-link">TanÄ±mlamalar</a>
                    <button onclick="logout()" class="btn btn-secondary-custom btn-sm ms-3">Ã‡Ä±kÄ±ÅŸ</button>
                </div>
            </div>
        </nav>

        <main class="container page">
            <div class="custom-card">
                <div class="card-header-custom">
                    <h2 class="section-title">Excel ile KiÅŸi Ekle</h2>
                    <a href="dashboard.html" class="btn btn-secondary-custom">
                        <i class="fas fa-arrow-left me-2"></i> KiÅŸi Listesi
                    </a>
                </div>

                <div style="padding: 2rem;">
                    <div class="alert alert-info mb-4" style="border-radius: 8px;">
                        <strong><i class="fas fa-info-circle me-2"></i> Excel DosyasÄ± FormatÄ±</strong>
                        <p class="mt-2 mb-2">
                            Excel dosyanÄ±z aÅŸaÄŸÄ±daki sÃ¼tunlarÄ± iÃ§ermelidir (en az isim ve soyisim zorunludur):
                        </p>
                        <ul style="margin-left: 1.5rem; list-style-type: disc;">
                            <li><strong>Zorunlu Alanlar:</strong> isim (veya ad), soyisim (veya soyad)</li>
                            <li><strong>Ä°steÄŸe BaÄŸlÄ± Alanlar:</strong> telefon, email, il, ilÃ§e, posta kodu, tam adres
                            </li>
                            <li><strong>DetaylÄ± Adres:</strong>
                                <ul>
                                    <li><strong>Mahalle:</strong> mahalle, mah, mahalle/kÃ¶y, semt</li>
                                    <li><strong>Sokak:</strong> sokak, cadde, sok, cad, sokak/cadde</li>
                                    <li><strong>Bina No:</strong> bina no, kapÄ± no, no, dÄ±ÅŸ kapÄ± no</li>
                                    <li><strong>Daire No:</strong> daire no, iÃ§ kapÄ± no, daire</li>
                                </ul>
                            </li>
                        </ul>
                    </div>

                    <form id="import-form">
                        <div class="form-group mb-4">
                            <label class="form-label fw-bold mb-2">Excel DosyasÄ± SeÃ§</label>
                            <div class="upload-area" onclick="document.getElementById('file-input').click()">
                                <i class="fas fa-cloud-upload-alt upload-icon"></i>
                                <p class="text-muted mb-1">DosyayÄ± sÃ¼rÃ¼kleyip bÄ±rakÄ±n veya seÃ§mek iÃ§in tÄ±klayÄ±n</p>
                                <span class="text-muted small">(.xlsx, .xls, .csv - Maks 5MB)</span>
                                <input type="file" id="file-input" class="form-input" accept=".xlsx,.xls,.csv"
                                    style="display: none;">
                            </div>
                            <p id="file-info" class="text-center mt-2 fw-bold text-primary" style="display: none;"></p>
                        </div>

                        <div id="result-message" style="display: none; border-radius: 8px;"></div>

                        <div class="d-flex justify-content-end">
                            <button type="submit" id="upload-btn" class="btn btn-primary-custom btn-lg" disabled>
                                <i class="fas fa-upload me-2"></i> DosyayÄ± YÃ¼kle
                            </button>
                        </div>
                    </form>

                    <hr class="divider" style="margin: 2rem 0; border-top: 1px solid #e2e8f0;">

                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h3 class="section-title" style="margin-bottom: 0;">Ã–rnek Excel Åablonu</h3>
                        <a href="ornek_sablon.xlsx" download="ornek_sablon.xlsx"
                            class="btn btn-secondary-custom btn-sm">
                            <i class="fas fa-download me-2"></i> Åablonu Ä°ndir
                        </a>
                    </div>
                    <div class="table-container"
                        style="border: 1px solid #e2e8f0; border-radius: 8px; overflow: hidden;">
                        <table class="custom-table">
                            <thead>
                                <tr>
                                    <th>isim</th>
                                    <th>soyisim</th>
                                    <th>telefon</th>
                                    <th>email</th>
                                    <th>il</th>
                                    <th>ilÃ§e</th>
                                    <th>mahalle</th>
                                    <th>sokak</th>
                                    <th>tam adres</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Ahmet</td>
                                    <td>YÄ±lmaz</td>
                                    <td>0532 123 4567</td>
                                    <td>ahmet@email.com</td>
                                    <td>Ä°stanbul</td>
                                    <td>KadÄ±kÃ¶y</td>
                                    <td>CaferaÄŸa Mahallesi</td>
                                    <td>Moda Caddesi</td>
                                    <td>Moda Cad. No:15 D:4</td>
                                </tr>
                                <tr>
                                    <td>AyÅŸe</td>
                                    <td>Demir</td>
                                    <td>0533 987 6543</td>
                                    <td>ayse@email.com</td>
                                    <td>Ankara</td>
                                    <td>Ã‡ankaya</td>
                                    <td>KÄ±zÄ±lay Mahallesi</td>
                                    <td>AtatÃ¼rk BulvarÄ±</td>
                                    <td>AtatÃ¼rk Bulv. No:25 D:8</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>

        <!-- Toast Container -->
        <div id="toast-container"></div>

        <script src="../js/api.js"></script>
        <script>
            // Check auth
            if (!localStorage.getItem('token')) {
                window.location.href = 'login.html';
            }

            // Load pending count
            loadPendingCount();

            const fileInput = document.getElementById('file-input');
            const fileInfo = document.getElementById('file-info');
            const uploadBtn = document.getElementById('upload-btn');
            const resultMessage = document.getElementById('result-message');

            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    fileInfo.textContent = `SeÃ§ilen dosya: ${file.name} (${(file.size / 1024).toFixed(1)} KB)`;
                    fileInfo.style.display = 'block';
                    uploadBtn.disabled = false;
                    resultMessage.style.display = 'none';
                } else {
                    fileInfo.style.display = 'none';
                    uploadBtn.disabled = true;
                }
            });

            document.getElementById('import-form').addEventListener('submit', async (e) => {
                e.preventDefault();

                const file = fileInput.files[0];
                if (!file) return;

                uploadBtn.disabled = true;
                uploadBtn.textContent = 'YÃ¼kleniyor...';

                try {
                    const response = await API.persons.import(file);
                    resultMessage.className = 'alert alert-success mt-3';
                    resultMessage.textContent = response.message;
                    resultMessage.style.display = 'block';
                    showToast(response.message, 'success');
                    fileInput.value = '';
                    fileInfo.style.display = 'none';
                } catch (error) {
                    resultMessage.className = 'alert alert-error mt-3';
                    resultMessage.textContent = error.message || 'YÃ¼kleme sÄ±rasÄ±nda hata oluÅŸtu';
                    resultMessage.style.display = 'block';
                    showToast(error.message, 'error');
                } finally {
                    uploadBtn.disabled = false;
                    uploadBtn.textContent = 'DosyayÄ± YÃ¼kle';
                }
            });

            async function loadPendingCount() {
                try {
                    const response = await API.changes.getPendingCount();
                    const badge = document.getElementById('pending-badge');
                    if (response.count > 0) {
                        badge.textContent = response.count;
                        badge.style.display = 'inline-flex';
                    }
                } catch (error) {
                    console.error('Error loading pending count:', error);
                }
            }

            function logout() {
                localStorage.removeItem('token');
                window.location.href = 'login.html';
            }
        </script>
    </body>

</html>